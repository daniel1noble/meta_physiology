---
title: "Supplemental Materials for: Meta-analytic approaches and new effect sizes to account for heterogeneous effects in comparative physiology"
author: Daniel W.A. Noble, Patrice Potter, Sammy Burke, Szymek Drobniak, Malgorzata Lagisz, Rose O’Dea, Shinichi Nakagawa
date: "`r Sys.Date()`"
bibliography: ../bib/refs.bib
csl: ../bib/the-journal-of-experimental-biology.csl
output: 
  bookdown::html_document2:
    code_folding: hide
    number_sections: no
    toc: yes
    toc_depth: 6
    toc_float: yes
  bookdown::word_document2:
    toc: no
    toc_depth: 6
    number_sections: false
    reference_docx: template.docx
editor_options: 
  chunk_output_type: console
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, cache = TRUE, tidy = TRUE)
```
```{r klippy, echo=FALSE, include=TRUE, message=FALSE, warning=FALSE}
#install.packages("devtools")
remotes::install_github("rlesur/klippy")
klippy::klippy(tooltip_message = 'Click to Copy Code', tooltip_success = 'Done', position = 'right', color = "red")
```

# Citation
This supplement is associated with a special issue review paper and can be cited as follows:

Daniel W.A. Noble, Patrice Potter, Sammy Burke, Szymek Drobniak, Malgorzata Lagisz, Rose O’Dea, Shinichi Nakagawa (2022) *Meta-analytic approaches and "new" effect sizes to account for heterogeneous effects in comparative physiology*. **Journal of Experimental Biology**

# Introduction

In this supplement we will demonstrate some of the principles we describe in our review paper. We'll show readers ways they can apply some of the 'new' effect sizes we describe to account for 'nuisance heterogeneity' in combination with multilevel meta-analytic models (MLMA) and/or multilevel meta-regression models. We realise that 'nuisance heterogeneity' may be a misnomer in some senses because such forms of heterogeneity may actually be the main interest of a given meta-analysis; in which case, multilevel meta-regressions are the way to go! 

We will overview two different case studies. The first case study will show readers how to account for known drivers of effect heterogeneity in the effect size, followed by how we can fit a MLMA (intercept only) model to estimate an overall meta-analytic mean. We then show readers how to interpret this mean and associated heterogeneity. In the second case study, we use a common effect size metric and instead model the 'nuisance' heterogeneity using a multi-level meta-regression approach. We also focus on showing readers how to interpret effects from this model along with heterogeneity. 

Throughout the supplement R code is contained within code blocks. We provide example data associated with this tutorial which readers can find on the [Open Science Framework](https://osf.io/wscz5/), but the code chunks should automatically download and load these for you. Importantly, all relevant code chunks have a 'copy and paste' button in the top right corner so that the code can be easily transferred to your own R console. 

# Loading Data and R Packages

Before embarking on the case studies readers will need to load the necessary R packages. 

```{r loadpackages, echo = TRUE, class.source='klippy'}
pacman::p_load(png, jpeg, pander, cowplot, flextable, tidyverse, metafor, orchaRd, here, osfr)

```

# Case Study 1: 
```{r class.source='klippy'}

# Example on how to download and load for reader. Should work anyway. Needs some testing
osfr::osf_retrieve_file("https://osf.io/mnw5d/") %>% osfr::osf_download()

data_CS1 <- read.csv(here::here("CaseStudy1.csv"))

```

# Case Study 2:
```{r class.source='klippy'}

osfr::osf_retrieve_file("https://osf.io/mnw5d/") %>% osfr::osf_download()

data_CS2 <- read.csv(here::here("BPA_example.csv"))

```

```{r}

```

# Supplementary Materials for Survey Study Selection

Here we provide greater detail on the search strategy, keyword selection and the numbers of final studies included at each step pf the screening process for our survey. Figure \@ref(fig:figS1) outlines our PRSIMA flowchart detailing the number of papers hit, their sources and how many records were excluded and included at each screening phase. The full search strings used to refine our search query can be found in Table \@ref(tab:tabS1). Note that results from our final searches (25 & 28) are the ones we used. Our query was restricted to a pre-specified set of comparative physiology journals within the last 6 years of publication. The journals used and their ISSN numbers are provided in Table \@ref(tab:tabS2). In total, out of the 79 papers screened at the full-text stage we ended up including 62 full texts. We excluded N = 17 meta-/comparative analyses because they: 1) did not include physiological traits (N = 4); 2) were empirical studies that collected their own data and did not collate data from the literature (N = 10); 3) Were not actual quantitative syntheses, but rather systematic reviews (N = 1) and 4) were studies with a focus on biomechanics (N = 2).

```{r figS1, fig.align='center', echo = FALSE, fig.cap="PRISMA flowchart for study selection and inclusion"}

img1 <- readPNG("../figs/PRISMA_diagram_v0.png")

p1 <- cowplot::ggdraw()+
        cowplot::draw_image(img1)
p1
```



```{r tabS1,  echo = FALSE, tab.cap="Log of search string development"}

table <- read.csv("../tables/Table_S1.csv")

table_s1 <- flextable(table)                                                                            %>% 
            flextable::compose(j = 1, part = "header", value = as_paragraph(as_b("Date")))              %>% 
            flextable::compose(j = 2, part = "header", value = as_paragraph(as_b("Search Number")))     %>% 
            flextable::compose(j = 3, part = "header", value = as_paragraph(as_b("Search String")))     %>% 
            flextable::compose(j = 4, part = "header", value = as_paragraph(as_b("Number of Records"))) %>% 
            flextable::compose(j = 5, part = "header", value = as_paragraph(as_b("Comments")))          %>% 
            flextable::compose(j = 6, part = "header", value = as_paragraph(as_b("Notes"))) 
 table_s1
```


```{r tabS2, echo = FALSE, tab.cap="Log of search string development"}

table <- read.csv("../tables/Table_S2.csv")

table_s2 <- flextable(table)                                                                            %>% 
            flextable::compose(j = 1, part = "header", value = as_paragraph(as_b("Journal Name")))      %>% 
            flextable::compose(j = 2, part = "header", value = as_paragraph(as_b("ISSN Number")))       %>% 
            flextable::width(j = 1, 5)
table_s2
```

# Session Information

```{r}
pander(sessionInfo(), locale = FALSE)
```